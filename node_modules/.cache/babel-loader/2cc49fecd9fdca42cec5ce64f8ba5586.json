{"ast":null,"code":"var _jsxFileName = \"/Users/ngjunwei/audio-room-2/src/App.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [startButtonDisabled, setStartButtonDisabled] = useState(false);\n  const [callButtonDisabled, setCallButtonDisabled] = useState(true);\n  const [hangupButtonDisabled, setHangupButtonDisabled] = useState(true);\n  const [pc1Local, setPc1Local] = useState(undefined);\n  const [pc2Local, setPc2Local] = useState(undefined);\n  const [pc1Remote, setPc1Remote] = useState(undefined);\n  const [pc2Remote, setPc2Remote] = useState(undefined);\n  const video1Ref = useRef(null);\n  const video2Ref = useRef(null);\n  const video3Ref = useRef(null);\n  const offerOptions = {\n    offerToReceiveAudio: 1,\n    offerToReceiveVideo: 1\n  };\n\n  function gotStream(stream) {\n    const video1 = video1Ref.current;\n    console.log(\"Received local stream\");\n    video1.srcObject = stream;\n    window.localStream = stream;\n    setCallButtonDisabled(false);\n  }\n\n  function start() {\n    console.log(\"Requesting local stream\");\n    setStartButtonDisabled(true);\n    navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true\n    }).then(gotStream).catch(e => console.log(\"getUserMedia() error: \", e));\n  }\n\n  async function call() {\n    setCallButtonDisabled(true);\n    setHangupButtonDisabled(false);\n    console.log(\"Starting calls\");\n    const audioTracks = window.localStream.getAudioTracks();\n    const videoTracks = window.localStream.getVideoTracks();\n\n    if (audioTracks.length > 0) {\n      console.log(`Using audio device: ${audioTracks[0].label}`);\n    }\n\n    if (videoTracks.length > 0) {\n      console.log(`Using video device: ${videoTracks[0].label}`);\n    } // Create an RTCPeerConnection via the polyfill.\n\n\n    const servers = null;\n    const newPc1Local = new RTCPeerConnection(servers);\n    const newPc1Remote = new RTCPeerConnection(servers);\n    const newPc2Local = new RTCPeerConnection(servers);\n    const newPc2Remote = new RTCPeerConnection(servers);\n    setPc1Local(newPc1Local);\n    setPc1Remote(newPc1Remote);\n    setPc2Local(newPc2Local);\n    setPc2Remote(newPc2Remote);\n\n    function iceCallback1Local(event) {\n      handleCandidate(event.candidate, newPc1Remote, \"pc1: \", \"local\");\n    }\n\n    function iceCallback1Remote(event) {\n      handleCandidate(event.candidate, newPc1Local, \"pc1: \", \"remote\");\n    }\n\n    function iceCallback2Local(event) {\n      handleCandidate(event.candidate, newPc2Remote, \"pc2: \", \"local\");\n    }\n\n    function iceCallback2Remote(event) {\n      handleCandidate(event.candidate, newPc2Local, \"pc2: \", \"remote\");\n    }\n\n    newPc1Remote.ontrack = gotRemoteStream1;\n    newPc1Local.onicecandidate = iceCallback1Local;\n    newPc1Remote.onicecandidate = iceCallback1Remote;\n    console.log(\"pc1: created local and remote peer connection objects\");\n    newPc2Remote.ontrack = gotRemoteStream2;\n    newPc2Local.onicecandidate = iceCallback2Local;\n    newPc2Remote.onicecandidate = iceCallback2Remote;\n    console.log(\"pc2: created local and remote peer connection objects\");\n    window.localStream.getTracks().forEach(track => newPc1Local.addTrack(track, window.localStream));\n    console.log(\"Adding local stream to pc1Local\");\n    const offer = await newPc1Local.createOffer(offerOptions);\n    gotDescription1Local(offer, newPc1Local, newPc1Remote);\n    const offer2 = await newPc2Local.createOffer(offerOptions);\n    gotDescription2Local(offer2, newPc2Local, newPc2Remote);\n    window.localStream.getTracks().forEach(track => newPc2Local.addTrack(track, window.localStream));\n    console.log(\"Adding local stream to pc2Local\");\n  }\n\n  function onCreateSessionDescriptionError(error) {\n    console.log(`Failed to create session description: ${error.toString()}`);\n  }\n\n  async function gotDescription1Local(desc, pc1Local, pc1Remote) {\n    pc1Local.setLocalDescription(desc);\n    console.log(`Offer from pc1Local\\n${desc.sdp}`);\n    pc1Remote.setRemoteDescription(desc); // Since the 'remote' side has no media stream we need\n    // to pass in the right constraints in order for it to\n    // accept the incoming offer of audio and video.\n\n    const answer = await pc1Remote.createAnswer();\n    gotDescription1Remote(answer, pc1Local, pc1Remote);\n  }\n\n  async function gotDescription1Remote(desc, pc1Local, pc1Remote) {\n    pc1Remote.setLocalDescription(desc);\n    console.log(`Answer from pc1Remote\\n${desc.sdp}`);\n    pc1Local.setRemoteDescription(desc);\n  }\n\n  async function gotDescription2Local(desc, pc2Local, pc2Remote) {\n    pc2Local.setLocalDescription(desc);\n    console.log(`Offer from pc2Local\\n${desc.sdp}`);\n    pc2Remote.setRemoteDescription(desc); // Since the 'remote' side has no media stream we need\n    // to pass in the right constraints in order for it to\n    // accept the incoming offer of audio and video.\n\n    const answer = await pc2Remote.createAnswer();\n    gotDescription2Remote(answer, pc2Local, pc2Remote);\n  }\n\n  async function gotDescription2Remote(desc, pc2Local, pc2Remote) {\n    pc2Remote.setLocalDescription(desc);\n    console.log(`Answer from pc2Remote\\n${desc.sdp}`);\n    pc2Local.setRemoteDescription(desc);\n  }\n\n  function hangup() {\n    console.log(\"Ending calls\");\n    console.log(pc1Local);\n    console.log(pc1Remote);\n    pc1Local.close();\n    pc1Remote.close();\n    pc2Local.close();\n    pc2Remote.close();\n    setPc1Local(undefined);\n    setPc1Remote(undefined);\n    setPc2Local(undefined);\n    setPc2Remote(undefined);\n    setHangupButtonDisabled(true);\n    setCallButtonDisabled(false);\n  }\n\n  function gotRemoteStream1(e) {\n    const video2 = video2Ref.current;\n\n    if (video2.srcObject !== e.streams[0]) {\n      video2.srcObject = e.streams[0];\n      console.log(\"pc1: received remote stream\");\n    }\n  }\n\n  function gotRemoteStream2(e) {\n    const video3 = video3Ref.current;\n\n    if (video3.srcObject !== e.streams[0]) {\n      video3.srcObject = e.streams[0];\n      console.log(\"pc2: received remote stream\");\n    }\n  }\n\n  function handleCandidate(candidate, dest, prefix, type) {\n    dest.addIceCandidate(candidate).then(onAddIceCandidateSuccess, onAddIceCandidateError);\n    console.log(`${prefix}New ${type} ICE candidate: ${candidate ? candidate.candidate : \"(null)\"}`);\n  }\n\n  function onAddIceCandidateSuccess() {\n    console.log(\"AddIceCandidate success.\");\n  }\n\n  function onAddIceCandidateError(error) {\n    console.log(`Failed to add ICE candidate: ${error.toString()}`);\n  }\n\n  function sleep(ms) {\n    return new Promise(resolve => {\n      setTimeout(resolve, ms);\n    });\n  }\n\n  useEffect(() => {\n    console.log(pc1Local);\n    console.log(pc2Local);\n    console.log(pc1Remote);\n    console.log(pc2Remote);\n  }, [pc1Local, pc1Remote, pc2Local, pc2Remote]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: [/*#__PURE__*/_jsxDEV(\"a\", {\n        href: \"//webrtc.github.io/samples/\",\n        title: \"WebRTC samples homepage\",\n        children: \"WebRTC samples\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"Multiple peer connections\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      id: \"video1\",\n      playsInline: true,\n      autoPlay: true,\n      muted: true,\n      ref: video1Ref\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      id: \"video2\",\n      playsInline: true,\n      autoPlay: true,\n      ref: video2Ref\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      id: \"video3\",\n      playsInline: true,\n      autoPlay: true,\n      ref: video3Ref\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        id: \"startButton\",\n        disabled: startButtonDisabled,\n        onClick: start,\n        children: \"Start\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        id: \"callButton\",\n        disabled: callButtonDisabled,\n        onClick: call,\n        children: \"Call\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        id: \"hangupButton\",\n        disabled: hangupButtonDisabled,\n        onClick: hangup,\n        children: \"Hang Up\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"View the console to see logging and to inspect the\", \" \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \"MediaStream\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this), \" object \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \"localStream\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 41\n      }, this), \".\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"For more information about RTCPeerConnection, see\", \" \", /*#__PURE__*/_jsxDEV(\"a\", {\n        href: \"http://www.html5rocks.com/en/tutorials/webrtc/basics/\",\n        title: \"HTML5 Rocks article about WebRTC by Sam Dutton\",\n        children: \"Getting Started With WebRTC\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 9\n      }, this), \".\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n      href: \"https://github.com/webrtc/samples/tree/gh-pages/src/content/peerconnection/multiple\",\n      title: \"View source for this page on GitHub\",\n      id: \"viewSource\",\n      children: \"View source on GitHub\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 214,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"8boFYxQ5sxGCtwxjjt8hOuO7GvA=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/ngjunwei/audio-room-2/src/App.js"],"names":["useEffect","useRef","useState","App","startButtonDisabled","setStartButtonDisabled","callButtonDisabled","setCallButtonDisabled","hangupButtonDisabled","setHangupButtonDisabled","pc1Local","setPc1Local","undefined","pc2Local","setPc2Local","pc1Remote","setPc1Remote","pc2Remote","setPc2Remote","video1Ref","video2Ref","video3Ref","offerOptions","offerToReceiveAudio","offerToReceiveVideo","gotStream","stream","video1","current","console","log","srcObject","window","localStream","start","navigator","mediaDevices","getUserMedia","audio","video","then","catch","e","call","audioTracks","getAudioTracks","videoTracks","getVideoTracks","length","label","servers","newPc1Local","RTCPeerConnection","newPc1Remote","newPc2Local","newPc2Remote","iceCallback1Local","event","handleCandidate","candidate","iceCallback1Remote","iceCallback2Local","iceCallback2Remote","ontrack","gotRemoteStream1","onicecandidate","gotRemoteStream2","getTracks","forEach","track","addTrack","offer","createOffer","gotDescription1Local","offer2","gotDescription2Local","onCreateSessionDescriptionError","error","toString","desc","setLocalDescription","sdp","setRemoteDescription","answer","createAnswer","gotDescription1Remote","gotDescription2Remote","hangup","close","video2","streams","video3","dest","prefix","type","addIceCandidate","onAddIceCandidateSuccess","onAddIceCandidateError","sleep","ms","Promise","resolve","setTimeout"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useState } from \"react\";\n\nfunction App() {\n  const [startButtonDisabled, setStartButtonDisabled] = useState(false);\n  const [callButtonDisabled, setCallButtonDisabled] = useState(true);\n  const [hangupButtonDisabled, setHangupButtonDisabled] = useState(true);\n  const [pc1Local, setPc1Local] = useState(undefined);\n  const [pc2Local, setPc2Local] = useState(undefined);\n  const [pc1Remote, setPc1Remote] = useState(undefined);\n  const [pc2Remote, setPc2Remote] = useState(undefined);\n\n  const video1Ref = useRef(null);\n  const video2Ref = useRef(null);\n  const video3Ref = useRef(null);\n\n  const offerOptions = {\n    offerToReceiveAudio: 1,\n    offerToReceiveVideo: 1,\n  };\n\n  function gotStream(stream) {\n    const video1 = video1Ref.current;\n    console.log(\"Received local stream\");\n    video1.srcObject = stream;\n    window.localStream = stream;\n    setCallButtonDisabled(false);\n  }\n\n  function start() {\n    console.log(\"Requesting local stream\");\n    setStartButtonDisabled(true);\n    navigator.mediaDevices\n      .getUserMedia({\n        audio: true,\n        video: true,\n      })\n      .then(gotStream)\n      .catch((e) => console.log(\"getUserMedia() error: \", e));\n  }\n\n  async function call() {\n    setCallButtonDisabled(true);\n    setHangupButtonDisabled(false);\n    console.log(\"Starting calls\");\n    const audioTracks = window.localStream.getAudioTracks();\n    const videoTracks = window.localStream.getVideoTracks();\n    if (audioTracks.length > 0) {\n      console.log(`Using audio device: ${audioTracks[0].label}`);\n    }\n    if (videoTracks.length > 0) {\n      console.log(`Using video device: ${videoTracks[0].label}`);\n    }\n    // Create an RTCPeerConnection via the polyfill.\n    const servers = null;\n\n    const newPc1Local = new RTCPeerConnection(servers);\n    const newPc1Remote = new RTCPeerConnection(servers);\n\n    const newPc2Local = new RTCPeerConnection(servers);\n    const newPc2Remote = new RTCPeerConnection(servers);\n\n    setPc1Local(newPc1Local);\n    setPc1Remote(newPc1Remote);\n    setPc2Local(newPc2Local);\n    setPc2Remote(newPc2Remote);\n\n    function iceCallback1Local(event) {\n      handleCandidate(event.candidate, newPc1Remote, \"pc1: \", \"local\");\n    }\n\n    function iceCallback1Remote(event) {\n      handleCandidate(event.candidate, newPc1Local, \"pc1: \", \"remote\");\n    }\n\n    function iceCallback2Local(event) {\n      handleCandidate(event.candidate, newPc2Remote, \"pc2: \", \"local\");\n    }\n\n    function iceCallback2Remote(event) {\n      handleCandidate(event.candidate, newPc2Local, \"pc2: \", \"remote\");\n    }\n\n    newPc1Remote.ontrack = gotRemoteStream1;\n    newPc1Local.onicecandidate = iceCallback1Local;\n\n    newPc1Remote.onicecandidate = iceCallback1Remote;\n    console.log(\"pc1: created local and remote peer connection objects\");\n\n    newPc2Remote.ontrack = gotRemoteStream2;\n    newPc2Local.onicecandidate = iceCallback2Local;\n    newPc2Remote.onicecandidate = iceCallback2Remote;\n    console.log(\"pc2: created local and remote peer connection objects\");\n\n    window.localStream\n      .getTracks()\n      .forEach((track) => newPc1Local.addTrack(track, window.localStream));\n    console.log(\"Adding local stream to pc1Local\");\n    const offer = await newPc1Local.createOffer(offerOptions);\n    gotDescription1Local(offer, newPc1Local, newPc1Remote);\n\n    const offer2 = await newPc2Local.createOffer(offerOptions);\n    gotDescription2Local(offer2, newPc2Local, newPc2Remote);\n\n    window.localStream\n      .getTracks()\n      .forEach((track) => newPc2Local.addTrack(track, window.localStream));\n    console.log(\"Adding local stream to pc2Local\");\n  }\n\n  function onCreateSessionDescriptionError(error) {\n    console.log(`Failed to create session description: ${error.toString()}`);\n  }\n\n  async function gotDescription1Local(desc, pc1Local, pc1Remote) {\n    pc1Local.setLocalDescription(desc);\n    console.log(`Offer from pc1Local\\n${desc.sdp}`);\n    pc1Remote.setRemoteDescription(desc);\n    // Since the 'remote' side has no media stream we need\n    // to pass in the right constraints in order for it to\n    // accept the incoming offer of audio and video.\n    const answer = await pc1Remote.createAnswer();\n    gotDescription1Remote(answer, pc1Local, pc1Remote);\n  }\n\n  async function gotDescription1Remote(desc, pc1Local, pc1Remote) {\n    pc1Remote.setLocalDescription(desc);\n    console.log(`Answer from pc1Remote\\n${desc.sdp}`);\n    pc1Local.setRemoteDescription(desc);\n  }\n\n  async function gotDescription2Local(desc, pc2Local, pc2Remote) {\n    pc2Local.setLocalDescription(desc);\n    console.log(`Offer from pc2Local\\n${desc.sdp}`);\n    pc2Remote.setRemoteDescription(desc);\n    // Since the 'remote' side has no media stream we need\n    // to pass in the right constraints in order for it to\n    // accept the incoming offer of audio and video.\n    const answer = await pc2Remote.createAnswer();\n\n    gotDescription2Remote(answer, pc2Local, pc2Remote);\n  }\n\n  async function gotDescription2Remote(desc, pc2Local, pc2Remote) {\n    pc2Remote.setLocalDescription(desc);\n    console.log(`Answer from pc2Remote\\n${desc.sdp}`);\n    pc2Local.setRemoteDescription(desc);\n  }\n\n  function hangup() {\n    console.log(\"Ending calls\");\n    console.log(pc1Local);\n    console.log(pc1Remote);\n    pc1Local.close();\n    pc1Remote.close();\n    pc2Local.close();\n    pc2Remote.close();\n    setPc1Local(undefined);\n    setPc1Remote(undefined);\n    setPc2Local(undefined);\n    setPc2Remote(undefined);\n    setHangupButtonDisabled(true);\n    setCallButtonDisabled(false);\n  }\n\n  function gotRemoteStream1(e) {\n    const video2 = video2Ref.current;\n    if (video2.srcObject !== e.streams[0]) {\n      video2.srcObject = e.streams[0];\n      console.log(\"pc1: received remote stream\");\n    }\n  }\n\n  function gotRemoteStream2(e) {\n    const video3 = video3Ref.current;\n    if (video3.srcObject !== e.streams[0]) {\n      video3.srcObject = e.streams[0];\n      console.log(\"pc2: received remote stream\");\n    }\n  }\n\n  function handleCandidate(candidate, dest, prefix, type) {\n    dest\n      .addIceCandidate(candidate)\n      .then(onAddIceCandidateSuccess, onAddIceCandidateError);\n    console.log(\n      `${prefix}New ${type} ICE candidate: ${\n        candidate ? candidate.candidate : \"(null)\"\n      }`\n    );\n  }\n\n  function onAddIceCandidateSuccess() {\n    console.log(\"AddIceCandidate success.\");\n  }\n\n  function onAddIceCandidateError(error) {\n    console.log(`Failed to add ICE candidate: ${error.toString()}`);\n  }\n\n  function sleep(ms) {\n    return new Promise((resolve) => {\n      setTimeout(resolve, ms);\n    });\n  }\n\n  useEffect(() => {\n    console.log(pc1Local);\n    console.log(pc2Local);\n    console.log(pc1Remote);\n    console.log(pc2Remote);\n  }, [pc1Local, pc1Remote, pc2Local, pc2Remote]);\n\n  return (\n    <div id=\"container\">\n      <h1>\n        <a href=\"//webrtc.github.io/samples/\" title=\"WebRTC samples homepage\">\n          WebRTC samples\n        </a>{\" \"}\n        <span>Multiple peer connections</span>\n      </h1>\n\n      <video id=\"video1\" playsInline autoPlay muted ref={video1Ref}></video>\n      <video id=\"video2\" playsInline autoPlay ref={video2Ref}></video>\n      <video id=\"video3\" playsInline autoPlay ref={video3Ref}></video>\n\n      <div>\n        <button id=\"startButton\" disabled={startButtonDisabled} onClick={start}>\n          Start\n        </button>\n        <button id=\"callButton\" disabled={callButtonDisabled} onClick={call}>\n          Call\n        </button>\n        <button\n          id=\"hangupButton\"\n          disabled={hangupButtonDisabled}\n          onClick={hangup}\n        >\n          Hang Up\n        </button>\n      </div>\n\n      <p>\n        View the console to see logging and to inspect the{\" \"}\n        <code>MediaStream</code> object <code>localStream</code>.\n      </p>\n\n      <p>\n        For more information about RTCPeerConnection, see{\" \"}\n        <a\n          href=\"http://www.html5rocks.com/en/tutorials/webrtc/basics/\"\n          title=\"HTML5 Rocks article about WebRTC by Sam Dutton\"\n        >\n          Getting Started With WebRTC\n        </a>\n        .\n      </p>\n\n      <a\n        href=\"https://github.com/webrtc/samples/tree/gh-pages/src/content/peerconnection/multiple\"\n        title=\"View source for this page on GitHub\"\n        id=\"viewSource\"\n      >\n        View source on GitHub\n      </a>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}